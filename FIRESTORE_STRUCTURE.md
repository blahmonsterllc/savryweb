# Firestore Database Structure

This document outlines the Firebase/Firestore collections and document structure for Savry.

## Collections

### `users/{userId}`
```typescript
{
  email: string
  name: string | null
  tier: 'FREE' | 'PRO'
  weeklyBudget: number | null
  monthlyBudget: number | null
  createdAt: Timestamp
  updatedAt: Timestamp
}
```

### `recipes/{recipeId}`
```typescript
{
  userId: string | null
  name: string
  description: string | null
  ingredients: Array<{name: string, quantity: string, unit: string}>
  instructions: Array<string>
  prepTime: number | null  // in minutes
  cookTime: number | null  // in minutes
  servings: number | null
  calories: number | null
  difficulty: string | null
  cuisine: string | null
  dietaryTags: string[]  // ['vegetarian', 'vegan', 'gluten-free']
  imageUrl: string | null
  source: 'GENERATED' | 'USER_CREATED' | 'COMMUNITY'
  autoGenerated: boolean
  isPublic: boolean
  usageCount: number
  likesCount: number
  viewsCount: number
  estimatedCost: number | null
  createdAt: Timestamp
  updatedAt: Timestamp
}
```

### `savedRecipes/{savedRecipeId}`
```typescript
{
  userId: string
  recipeId: string
  createdAt: Timestamp
}
```
**Composite Index:** `userId` + `recipeId`

### `mealPlans/{mealPlanId}`
```typescript
{
  userId: string
  name: string
  startDate: Timestamp
  endDate: Timestamp
  budget: number | null
  totalCost: number | null
  actualCost: number | null
  isCompleted: boolean
  rating: number | null  // 1-5 stars
  notes: string | null
  createdAt: Timestamp
  updatedAt: Timestamp
}
```

### `mealPlans/{mealPlanId}/recipes/{recipeId}`
**Subcollection of mealPlans**
```typescript
{
  recipeId: string
  dayOfWeek: number  // 0-6 (Sunday-Saturday)
  mealType: 'BREAKFAST' | 'LUNCH' | 'DINNER' | 'SNACK'
  createdAt: Timestamp
}
```

### `groceryLists/{listId}`
```typescript
{
  userId: string
  mealPlanId: string | null
  name: string
  items: Array<{
    name: string
    quantity: string
    unit: string
    category: string
    price?: number
    store?: string
    aisle?: string
    section?: string
    checked?: boolean
  }>
  totalCost: number | null
  createdAt: Timestamp
  updatedAt: Timestamp
}
```

### `storeItemLocations/{locationId}`
```typescript
{
  storeName: string
  storeChain: string  // 'Kroger', 'Safeway', etc.
  location: string  // zip code or city
  itemName: string
  category: string
  aisle: string  // 'Aisle 5'
  section: string  // 'Dairy', 'Produce', etc.
  shelfLocation: string | null
  createdAt: Timestamp
  updatedAt: Timestamp
}
```
**Composite Index:** `storeChain` + `location` + `itemName`

### `supermarketDiscounts/{discountId}`
```typescript
{
  storeName: string
  itemName: string
  category: string | null
  originalPrice: number
  discountPrice: number
  discountPercent: number
  validFrom: Timestamp
  validUntil: Timestamp
  location: string | null  // zip code or city
  createdAt: Timestamp
}
```
**Indexes:** `validUntil`, `storeName`, `location`

### `recipeLikes/{likeId}`
```typescript
{
  userId: string
  recipeId: string
  createdAt: Timestamp
}
```
**Composite Index:** `userId` + `recipeId`

### `recipeViews/{viewId}`
```typescript
{
  userId: string
  recipeId: string
  viewedAt: Timestamp
}
```
**Indexes:** `recipeId`, `userId`

### `favoriteMealPlans/{favoriteId}`
```typescript
{
  userId: string
  mealPlanId: string
  notes: string | null
  createdAt: Timestamp
}
```
**Composite Index:** `userId` + `mealPlanId`

### `budgetEntries/{entryId}`
```typescript
{
  userId: string
  amount: number
  category: string  // 'groceries', 'dining_out', etc.
  description: string | null
  date: Timestamp
  type: 'PLANNED' | 'ACTUAL'
  createdAt: Timestamp
}
```
**Indexes:** `userId`, `date`

## Security Rules

Remember to set up Firestore Security Rules in Firebase Console:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can only read/write their own data
    match /users/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Recipes - users can read public, write their own
    match /recipes/{recipeId} {
      allow read: if resource.data.isPublic == true || 
                     (request.auth != null && resource.data.userId == request.auth.uid);
      allow create: if request.auth != null;
      allow update, delete: if request.auth != null && resource.data.userId == request.auth.uid;
    }
    
    // Add similar rules for other collections...
  }
}
```





